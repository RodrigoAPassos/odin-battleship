(()=>{"use strict";const e=e=>{let t=0,i=!1;const a=e;return{isSunk:()=>(i=t==a,i),hit:()=>++t}},t=()=>{const t=(()=>{const t=[];for(let e=0;e<100;e++)t.push({hasShip:!1,nearShip:!1,shipName:null,wasShot:!1});return{grid:t,place:(i,a,r)=>{if("patrol"==r){for(let e=0;e<1;e++)if("h"==a){if(0==t[i+e].hasShip&&0==t[i+e].nearShip)continue;if(1==t[i+e].hasShip||1==t[i+e].nearShip)return}else{if(0==t[i+10*e].hasShip&&0==t[i+10*e].nearShip)continue;if(1==t[i+10*e].hasShip||1==t[i+10*e].nearShip)return}const n=e(1);for(let e=0;e<1;e++)"h"==a?(t[i+e].hasShip=!0,t[i+e].shipName=n,i+(e+10)<100&&(t[i+(e+10)].nearShip=!0),i+(e-10)>0&&(t[i+(e-10)].nearShip=!0),0==e&&(i-1>0&&(t[i-1].nearShip=!0),i+e+1<100&&(t[i+e+1].nearShip=!0))):(t[i+10*e].hasShip=!0,t[i+10*e].shipName=n,t[i+10*e+1].nearShip=!0,t[i+10*e-1].nearShip=!0,0==e&&(t[i-10].nearShip=!0,t[i+10*e+10].nearShip=!0));return r}if("submarine"==r){if("h"==a&&/[9]$/.test(i))return;if("v"==a&&i>89)return;for(let e=0;e<2;e++)if("h"==a){if(0==t[i+e].hasShip&&0==t[i+e].nearShip)continue;if(1==t[i+e].hasShip||1==t[i+e].nearShip)return}else{if(0==t[i+10*e].hasShip&&0==t[i+10*e].nearShip)continue;if(1==t[i+10*e].hasShip||1==t[i+10*e].nearShip)return}const n=e(2);for(let e=0;e<2;e++)"h"==a?(t[i+e].hasShip=!0,t[i+e].shipName=n,t[i+(e+10)].nearShip=!0,t[i+(e-10)].nearShip=!0,0==e&&(t[i-1].nearShip=!0),1==e&&(t[i+e+1].nearShip=!0)):(t[i+10*e].hasShip=!0,t[i+10*e].shipName=n,t[i+10*e+1].nearShip=!0,t[i+10*e-1].nearShip=!0,0==e&&(t[i-10].nearShip=!0),1==e&&(t[i+10*e+10].nearShip=!0));return r}if("destroyer"==r){if("h"==a&&/[8-9]$/.test(i))return;if("v"==a&&i>79)return;for(let e=0;e<3;e++)if("h"==a){if(0==t[i+e].hasShip&&0==t[i+e].nearShip)continue;if(1==t[i+e].hasShip||1==t[i+e].nearShip)return}else{if(0==t[i+10*e].hasShip&&0==t[i+10*e].nearShip)continue;if(1==t[i+10*e].hasShip||1==t[i+10*e].nearShip)return}const n=e(3);for(let e=0;e<3;e++)"h"==a?(t[i+e].hasShip=!0,t[i+e].shipName=n,t[i+(e+10)].nearShip=!0,t[i+(e-10)].nearShip=!0,0==e&&(t[i-1].nearShip=!0),2==e&&(t[i+e+1].nearShip=!0)):(t[i+10*e].hasShip=!0,t[i+10*e].shipName=n,t[i+10*e+1].nearShip=!0,t[i+10*e-1].nearShip=!0,0==e&&(t[i-10].nearShip=!0),2==e&&(t[i+10*e+10].nearShip=!0));return r}if("battleship"==r){if("h"==a&&/[7-9]$/.test(i))return;if("v"==a&&i>69)return;for(let e=0;e<4;e++)if("h"==a){if(0==t[i+e].hasShip&&0==t[i+e].nearShip)continue;if(1==t[i+e].hasShip||1==t[i+e].nearShip)return}else{if(0==t[i+10*e].hasShip&&0==t[i+10*e].nearShip)continue;if(1==t[i+10*e].hasShip||1==t[i+10*e].nearShip)return}const n=e(4);for(let e=0;e<4;e++)"h"==a?(t[i+e].hasShip=!0,t[i+e].shipName=n,t[i+(e+10)].nearShip=!0,t[i+(e-10)].nearShip=!0,0==e&&(t[i-1].nearShip=!0),3==e&&(t[i+e+1].nearShip=!0)):(t[i+10*e].hasShip=!0,t[i+10*e].shipName=n,t[i+10*e+1].nearShip=!0,t[i+10*e-1].nearShip=!0,0==e&&(t[i-10].nearShip=!0),3==e&&(t[i+10*e+10].nearShip=!0));return r}if("carrier"==r){if("h"==a&&/[6-9]$/.test(i))return;if("v"==a&&i>59)return;for(let e=0;e<5;e++)if("h"==a){if(0==t[i+e].hasShip&&0==t[i+e].nearShip)continue;if(1==t[i+e].hasShip||1==t[i+e].nearShip)return}else{if(0==t[i+10*e].hasShip&&0==t[i+10*e].nearShip)continue;if(1==t[i+10*e].hasShip||1==t[i+10*e].nearShip)return}const n=e(5);for(let e=0;e<5;e++)"h"==a?(t[i+e].hasShip=!0,t[i+e].shipName=n,t[i+(e+10)].nearShip=!0,t[i+(e-10)].nearShip=!0,0==e&&(t[i-1].nearShip=!0),4==e&&(t[i+e+1].nearShip=!0)):(t[i+10*e].hasShip=!0,t[i+10*e].shipName=n,t[i+10*e+1].nearShip=!0,t[i+10*e-1].nearShip=!0,0==e&&(t[i-10].nearShip=!0),4==e&&(t[i+10*e+10].nearShip=!0));return r}},receiveAttack:e=>1==t[e].hasShip?(t[e].wasShot=!0,t[e].shipName.hit(),"hit"):(t[e].wasShot=!0,"miss"),checkAllSunk:()=>t.filter((e=>null!=e.shipName)).every((e=>1==e.shipName.isSunk()))}})();let i=null,a=null,r=null,n=0;const s=(e,t)=>0==t.Gameboard.grid[e].wasShot?"hit"==t.Gameboard.receiveAttack(e)?"valid hit attack":"valid miss attack":"invalid attack",d=e=>{if(null==a){let t=Math.floor(100*Math.random());if(i=s(t,e),"valid hit attack"==i)a=t,r=t;else for(;"invalid attack"==i;)d(e)}else if(0==e.Gameboard.grid[a].shipName.isSunk()){let t;switch(n){case 0:t=a+1,t<100?i=s(t,e):(n++,d(e)),"valid hit attack"==i?a=t:"valid miss attack"==i?n++:(n++,d(e));break;case 1:t=r-1,t<100&&t>=0?i=s(t,e):n++,"valid hit attack"==i?r=t:"valid miss attack"==i?n++:(n++,d(e));break;case 2:t=a+10,t<100?i=s(t,e):(n++,d(e)),"valid hit attack"==i?a=t:"valid miss attack"==i?n++:(n++,d(e));break;case 3:t=r-10,t>=0&&(i=s(t,e)),"valid hit attack"==i&&(r=t)}}else a=null,r=null,n=0,d(e)};return{Gameboard:t,attackPlayer:s,computerAttack:d}};function i(e){e.dataTransfer.setData("text",e.target.id)}function a(e){"h"==e.target.getAttribute("data-orientation")?e.target.setAttribute("data-orientation","v"):e.target.setAttribute("data-orientation","h")}let r=[];const n=["patrol","submarine","destroyer","battleship","carrier"],s=(e,t,i)=>{const a=document.querySelector(".player1 .shipsBoard"),l=document.querySelector(".player1 .attackBoard"),c=document.querySelector(".winner"),p=document.querySelector(".waiting");switch(i){case"pvcPlace":for(d();a.firstChild;)a.removeChild(a.firstChild);for(let i of e.Gameboard.grid){const n=document.createElement("div");n.classList.add("cell"),n.setAttribute("data-index",e.Gameboard.grid.indexOf(i)),1==i.hasShip&&n.classList.add("hasShip"),1==i.wasShot&&0==i.hasShip&&n.classList.add("waterHit"),1==i.wasShot&&1==i.hasShip&&n.classList.add("shipHit"),null!=i.shipName&&1==i.shipName.isSunk()&&n.classList.add("shipSunk"),0==i.hasShip&&(n.addEventListener("drop",(function(i){i.preventDefault();let a=i.dataTransfer.getData("text"),n=document.getElementById(a).getAttribute("data-orientation"),d=i.target.getAttribute("data-index"),h=e.Gameboard.place(Number(d),n,a);r.push(h),s(e,t,"pvcPlace")})),n.addEventListener("dragover",(function(t){1!=e.Gameboard.grid[t.target.getAttribute("data-index")].hasShip&&1!=e.Gameboard.grid[t.target.getAttribute("data-index")].nearShip||(t.target.style.border="1px dashed red"),t.preventDefault()}))),a.appendChild(n)}if(1==n.every((e=>r.includes(e)))){for(;p.firstChild;)p.removeChild(p.firstChild);c.innerHTML="Player 1",a.style.visibility="visible",l.style.visibility="visible";const i=document.createElement("div"),r=document.createElement("div");i.innerHTML="Your Ships Grid",r.innerHTML="Your Attack Grid",p.appendChild(i),p.appendChild(r),t.Gameboard.place(4,"v","patrol"),t.Gameboard.place(0,"v","submarine"),t.Gameboard.place(24,"h","destroyer"),t.Gameboard.place(74,"h","battleship"),t.Gameboard.place(54,"h","carrier"),s(e,t,"pvc")}break;case"pvpPlace":case"pvp":break;case"pvc":for(;a.firstChild;)a.removeChild(a.firstChild);for(;l.firstChild;)l.removeChild(l.firstChild);for(let t of e.Gameboard.grid){const i=document.createElement("div");i.classList.add("cell"),i.setAttribute("data-index",e.Gameboard.grid.indexOf(t)),1==t.hasShip&&i.classList.add("hasShip"),1==t.wasShot&&0==t.hasShip&&i.classList.add("waterHit"),1==t.wasShot&&1==t.hasShip&&i.classList.add("shipHit"),null!=t.shipName&&1==t.shipName.isSunk()&&i.classList.add("shipSunk"),a.appendChild(i)}for(let i of t.Gameboard.grid){const a=document.createElement("div");a.classList.add("cell"),a.setAttribute("data-index",t.Gameboard.grid.indexOf(i)),1==i.wasShot&&1==i.hasShip&&a.classList.add("shipHit"),1==i.wasShot&&0==i.hasShip&&a.classList.add("waterHit"),null!=i.shipName&&1==i.shipName.isSunk()&&a.classList.add("shipSunk"),0==i.wasShot&&a.addEventListener("click",(()=>{e.attackPlayer(a.getAttribute("data-index"),t),t.computerAttack(e),s(e,t,"pvc"),h(e,t)})),l.appendChild(a)}break;case"restart":r=[],s(e,t,"pvcPlace")}},d=()=>{const e=document.querySelector(".winner"),t=document.querySelector(".waiting");for(e.innerHTML="Please drag and drop all your ships...";t.firstChild;)t.removeChild(t.firstChild);const n=document.createElement("ul");n.classList.add("shipList");const s=document.createElement("li");s.innerHTML="Patrol",r.includes("patrol")&&(s.style.visibility="hidden"),s.setAttribute("id","patrol"),s.setAttribute("data-orientation","h"),s.setAttribute("draggable","true"),s.addEventListener("click",a),s.addEventListener("dragstart",i);const d=document.createElement("li");d.innerHTML="Submarine",r.includes("submarine")&&(d.style.visibility="hidden"),d.setAttribute("id","submarine"),d.setAttribute("data-orientation","h"),d.setAttribute("draggable","true"),d.addEventListener("click",a),d.addEventListener("dragstart",i);const h=document.createElement("li");h.innerHTML="Destroyer",r.includes("destroyer")&&(h.style.visibility="hidden"),h.setAttribute("id","destroyer"),h.setAttribute("data-orientation","h"),h.setAttribute("draggable","true"),h.addEventListener("click",a),h.addEventListener("dragstart",i);const l=document.createElement("li");l.innerHTML="Battleship",r.includes("battleship")&&(l.style.visibility="hidden"),l.setAttribute("id","battleship"),l.setAttribute("data-orientation","h"),l.setAttribute("draggable","true"),l.addEventListener("click",a),l.addEventListener("dragstart",i);const c=document.createElement("li");c.innerHTML="Carrier",r.includes("carrier")&&(c.style.visibility="hidden"),c.setAttribute("id","carrier"),c.setAttribute("data-orientation","h"),c.setAttribute("draggable","true"),c.addEventListener("click",a),c.addEventListener("dragstart",i),n.appendChild(s),n.appendChild(d),n.appendChild(h),n.appendChild(l),n.appendChild(c),t.appendChild(n)},h=(e,t)=>{const i=document.querySelector(".player1 .attackBoard"),a=document.querySelector(".winner"),r=document.querySelector(".player1 .shipsBoard"),n=document.querySelector(".waiting");if(1==e.Gameboard.checkAllSunk()&&1==t.Gameboard.checkAllSunk())r.style.visibility="hidden",i.style.visibility="hidden",n.style.visibility="hidden",a.innerHTML="It's a Tie!";else if(1==e.Gameboard.checkAllSunk()&&0==t.Gameboard.checkAllSunk())r.style.visibility="hidden",i.style.visibility="hidden",n.style.visibility="hidden",a.innerHTML="Player 2 Won!";else{if(0!=e.Gameboard.checkAllSunk()||1!=t.Gameboard.checkAllSunk())return;r.style.visibility="hidden",i.style.visibility="hidden",n.style.visibility="hidden",a.innerHTML="Player 1 Won!"}},l=s,c=e=>{const i=document.querySelector(".newGameBtn");i.innerHTML="Restart",i.removeEventListener("click",p),i.addEventListener("click",(function(){location.reload()})),document.querySelector(".playVs").style.visibility="hidden",(e=>{const i=t(),a=t();l(i,a,"pvcPlace")})()},p=()=>{const e=document.querySelector(".playVs");"hidden"==e.style.visibility?e.style.visibility="visible":e.style.visibility="hidden"};document.querySelector(".playVs").style.visibility="hidden",document.querySelector(".newGameBtn").addEventListener("click",p),document.querySelector("button.PvC").addEventListener("click",(()=>c())),document.querySelector(".PvP").addEventListener("click",(()=>c()))})();