(()=>{"use strict";const e=e=>{let i=0,t=!1;const a=e;return{isSunk:()=>(t=i==a,t),hit:()=>++i}},i=()=>{const i=(()=>{const i=[];for(let e=0;e<10;e++){i[e]=[];for(let t=0;t<10;t++)i[e][t]={hasShip:!1,nearShip:!1,shipName:null,wasShot:!1}}return{grid:i,place:(t,a,n,r)=>{if("patrol"==r){for(let e=0;e<1;e++)if("v"==n){if(0==i[t+e][a].hasShip&&0==i[t+e][a].nearShip)continue;if(1==i[t+e][a].hasShip||1==i[t+e][a].nearShip)return}else{if(0==i[t][a+e].hasShip&&0==i[t][a+e].nearShip)continue;if(1==i[t][a+e].hasShip||1==i[t][a+e].nearShip)return}const s=e(1);for(let e=0;e<1;e++)"v"==n?(i[t+e][a].hasShip=!0,i[t+e][a].shipName=s,[t+e]in i&&[a+1]in i[t+e]&&(i[t+e][a+1].nearShip=!0),[t+e]in i&&[a-1]in i[t+e]&&(i[t+e][a-1].nearShip=!0),[t+1]in i&&[a]in i[t+1]&&(i[t+1][a].nearShip=!0),[t-1]in i&&[a]in i[t-1]&&(i[t-1][a].nearShip=!0)):(i[t][a+e].hasShip=!0,i[t][a+e].shipName=s,[t+e]in i&&[a+1]in i[t+e]&&(i[t+e][a+1].nearShip=!0),[t+e]in i&&[a-1]in i[t+e]&&(i[t+e][a-1].nearShip=!0),[t+1]in i&&[a]in i[t+1]&&(i[t+1][a].nearShip=!0),[t-1]in i&&[a]in i[t-1]&&(i[t-1][a].nearShip=!0));return r}if("submarine"==r){if("h"==n&&a>=9)return;if("v"==n&&t>=9)return;for(let e=0;e<2;e++)if("v"==n){if(0==i[t+e][a].hasShip&&0==i[t+e][a].nearShip)continue;if(1==i[t+e][a].hasShip||1==i[t+e][a].nearShip)return}else{if(0==i[t][a+e].hasShip&&0==i[t][a+e].nearShip)continue;if(1==i[t][a+e].hasShip||1==i[t][a+e].nearShip)return}const s=e(2);for(let e=0;e<2;e++)"v"==n?(i[t+e][a].hasShip=!0,i[t+e][a].shipName=s,[t+e]in i&&[a+1]in i[t+e]&&(i[t+e][a+1].nearShip=!0),[t+e]in i&&[a-1]in i[t+e]&&(i[t+e][a-1].nearShip=!0),[t+2]in i&&[a]in i[t+2]&&(i[t+2][a].nearShip=!0),[t-1]in i&&[a]in i[t-1]&&(i[t-1][a].nearShip=!0)):(i[t][a+e].hasShip=!0,i[t][a+e].shipName=s,[t+1]in i&&[a+e]in i[t+1]&&(i[t+1][a+e].nearShip=!0),[t-1]in i&&[a+e]in i[t-1]&&(i[t-1][a+e].nearShip=!0),[t]in i&&[a+2]in i[t]&&(i[t][a+2].nearShip=!0),[t]in i&&[a-1]in i[t]&&(i[t][a-1].nearShip=!0));return r}if("destroyer"==r){if("h"==n&&a>=8)return;if("v"==n&&t>=8)return;for(let e=0;e<3;e++)if("v"==n){if(0==i[t+e][a].hasShip&&0==i[t+e][a].nearShip)continue;if(1==i[t+e][a].hasShip||1==i[t+e][a].nearShip)return}else{if(0==i[t][a+e].hasShip&&0==i[t][a+e].nearShip)continue;if(1==i[t][a+e].hasShip||1==i[t][a+e].nearShip)return}const s=e(3);for(let e=0;e<3;e++)"v"==n?(i[t+e][a].hasShip=!0,i[t+e][a].shipName=s,[t+e]in i&&[a+1]in i[t+e]&&(i[t+e][a+1].nearShip=!0),[t+e]in i&&[a-1]in i[t+e]&&(i[t+e][a-1].nearShip=!0),[t+3]in i&&[a]in i[t+3]&&(i[t+3][a].nearShip=!0),[t-1]in i&&[a]in i[t-1]&&(i[t-1][a].nearShip=!0)):(i[t][a+e].hasShip=!0,i[t][a+e].shipName=s,[t+1]in i&&[a+e]in i[t+1]&&(i[t+1][a+e].nearShip=!0),[t-1]in i&&[a+e]in i[t-1]&&(i[t-1][a+e].nearShip=!0),[t]in i&&[a+3]in i[t]&&(i[t][a+3].nearShip=!0),[t]in i&&[a-1]in i[t]&&(i[t][a-1].nearShip=!0));return r}if("battleship"==r){if("h"==n&&a>=7)return;if("v"==n&&t>=7)return;for(let e=0;e<4;e++)if("v"==n){if(0==i[t+e][a].hasShip&&0==i[t+e][a].nearShip)continue;if(1==i[t+e][a].hasShip||1==i[t+e][a].nearShip)return}else{if(0==i[t][a+e].hasShip&&0==i[t][a+e].nearShip)continue;if(1==i[t][a+e].hasShip||1==i[t][a+e].nearShip)return}const s=e(4);for(let e=0;e<4;e++)"v"==n?(i[t+e][a].hasShip=!0,i[t+e][a].shipName=s,[t+e]in i&&[a+1]in i[t+e]&&(i[t+e][a+1].nearShip=!0),[t+e]in i&&[a-1]in i[t+e]&&(i[t+e][a-1].nearShip=!0),[t+4]in i&&[a]in i[t+4]&&(i[t+4][a].nearShip=!0),[t-1]in i&&[a]in i[t-1]&&(i[t-1][a].nearShip=!0)):(i[t][a+e].hasShip=!0,i[t][a+e].shipName=s,[t+1]in i&&[a+e]in i[t+1]&&(i[t+1][a+e].nearShip=!0),[t-1]in i&&[a+e]in i[t-1]&&(i[t-1][a+e].nearShip=!0),[t]in i&&[a+4]in i[t]&&(i[t][a+4].nearShip=!0),[t]in i&&[a-1]in i[t]&&(i[t][a-1].nearShip=!0));return r}if("carrier"==r){if("h"==n&&a>=6)return;if("v"==n&&t>=6)return;for(let e=0;e<5;e++)if("v"==n){if(0==i[t+e][a].hasShip&&0==i[t+e][a].nearShip)continue;if(1==i[t+e][a].hasShip||1==i[t+e][a].nearShip)return}else{if(0==i[t][a+e].hasShip&&0==i[t][a+e].nearShip)continue;if(1==i[t][a+e].hasShip||1==i[t][a+e].nearShip)return}const s=e(5);for(let e=0;e<5;e++)"v"==n?(i[t+e][a].hasShip=!0,i[t+e][a].shipName=s,[t+e]in i&&[a+1]in i[t+e]&&(i[t+e][a+1].nearShip=!0),[t+e]in i&&[a-1]in i[t+e]&&(i[t+e][a-1].nearShip=!0),[t+5]in i&&[a]in i[t+5]&&(i[t+5][a].nearShip=!0),[t-1]in i&&[a]in i[t-1]&&(i[t-1][a].nearShip=!0)):(i[t][a+e].hasShip=!0,i[t][a+e].shipName=s,[t+1]in i&&[a+e]in i[t+1]&&(i[t+1][a+e].nearShip=!0),[t-1]in i&&[a+e]in i[t-1]&&(i[t-1][a+e].nearShip=!0),[t]in i&&[a+5]in i[t]&&(i[t][a+5].nearShip=!0),[t]in i&&[a-1]in i[t]&&(i[t][a-1].nearShip=!0));return r}},receiveAttack:(e,t)=>1==i[e][t].hasShip?(i[e][t].wasShot=!0,i[e][t].shipName.hit(),"hit"):(i[e][t].wasShot=!0,"miss"),checkAllSunk:()=>i.every((e=>e.filter((e=>null!=e.shipName)).every((e=>1==e.shipName.isSunk()))))}})();let t=null,a=[],n=[],r=0;const s=(e,i,t)=>0==t.Gameboard.grid[e][i].wasShot?"hit"==t.Gameboard.receiveAttack(e,i)?"valid hit attack":"valid miss attack":"invalid attack",d=e=>{if(0==a.length){let i=Math.floor(10*Math.random()),r=Math.floor(10*Math.random());if(t=s(i,r,e),"valid hit attack"==t)a.push(i,r),n.push(i,r);else for(;"invalid attack"==t;)d(e)}else if(0==e.Gameboard.grid[a[0]][a[1]].shipName.isSunk()){let i,l;switch(r){case 0:i=a[0]+1,l=a[1],i<10?(t=s(i,l,e),"valid hit attack"==t?a[0]=i:"valid miss attack"==t?r++:(r++,d(e))):(r++,d(e));break;case 1:i=n[0]-1,l=n[1],i>=0?(t=s(i,l,e),"valid hit attack"==t?n[0]=i:"valid miss attack"==t?r++:(r++,d(e))):(r++,d(e));break;case 2:i=a[0],l=a[1]+1,l<10?(t=s(i,l,e),"valid hit attack"==t?a[1]=l:"valid miss attack"==t?r++:(r++,d(e))):(r++,d(e));break;case 3:i=n[0],l=n[1]-1,l>=0&&(t=s(i,l,e),"valid hit attack"==t&&(n[1]=l))}}else a=[],n=[],r=0,d(e)};return{Gameboard:i,attackPlayer:s,computerAttack:d,listOfShips:[]}};function t(e){e.dataTransfer.setData("text",e.target.id)}function a(e){"h"==e.target.getAttribute("data-orientation")?e.target.setAttribute("data-orientation","v"):e.target.setAttribute("data-orientation","h")}const n=["patrol","submarine","destroyer","battleship","carrier"],r=(e,i,t,a=e)=>{const c=document.querySelector(".player1 .shipsBoard"),o=document.querySelector(".player1 .attackBoard"),p=document.querySelector(".winner"),u=document.querySelector(".waiting");switch(t){case"pvcPlace":for(s(e,i,t,a);c.firstChild;)c.removeChild(c.firstChild);if(e.Gameboard.grid.forEach((t=>{t.forEach((a=>{const n=document.createElement("div");n.classList.add("cell");let s=e.Gameboard.grid.indexOf(t),d=t.indexOf(a);n.setAttribute("data-indexX",s),n.setAttribute("data-indexY",d),1==a.hasShip&&n.classList.add("hasShip"),1==a.wasShot&&0==a.hasShip&&n.classList.add("waterHit"),1==a.wasShot&&1==a.hasShip&&n.classList.add("shipHit"),null!=a.shipName&&1==a.shipName.isSunk()&&n.classList.add("shipSunk"),0==a.hasShip&&(n.addEventListener("drop",(function(t){t.preventDefault();let a=t.dataTransfer.getData("text"),n=document.getElementById(a).getAttribute("data-orientation"),s=t.target.getAttribute("data-indexX"),d=t.target.getAttribute("data-indexY"),l=e.Gameboard.place(Number(s),Number(d),n,a);e.listOfShips.push(l),r(e,i,"pvcPlace")})),n.addEventListener("dragover",(function(i){1!=e.Gameboard.grid[i.target.getAttribute("data-indexX")][i.target.getAttribute("data-indexY")].hasShip&&1!=e.Gameboard.grid[i.target.getAttribute("data-indexX")][i.target.getAttribute("data-indexY")].nearShip||(i.target.style.border="1px dashed red"),i.preventDefault()}))),c.appendChild(n)}))})),1==n.every((i=>e.listOfShips.includes(i)))){for(;u.firstChild;)u.removeChild(u.firstChild);p.innerHTML="Player 1",c.style.visibility="visible",o.style.visibility="visible";const t=document.createElement("div"),a=document.createElement("div");t.innerHTML="Your Ships Grid",a.innerHTML="Your Attack Grid",u.appendChild(t),u.appendChild(a),l(i),r(e,i,"pvc")}break;case"pvpPlace":for(s(e,i,t,a);c.firstChild;)c.removeChild(c.firstChild);a.Gameboard.grid.forEach((s=>{s.forEach((d=>{const l=document.createElement("div");l.classList.add("cell");let o=a.Gameboard.grid.indexOf(s),p=s.indexOf(d);l.setAttribute("data-indexX",o),l.setAttribute("data-indexY",p),1==d.hasShip&&l.classList.add("hasShip"),1==d.wasShot&&0==d.hasShip&&l.classList.add("waterHit"),1==d.wasShot&&1==d.hasShip&&l.classList.add("shipHit"),null!=d.shipName&&1==d.shipName.isSunk()&&l.classList.add("shipSunk"),0==d.hasShip&&(l.addEventListener("drop",(function(s){s.preventDefault();let d=s.dataTransfer.getData("text"),l=document.getElementById(d).getAttribute("data-orientation"),c=s.target.getAttribute("data-indexX"),o=s.target.getAttribute("data-indexY"),p=a.Gameboard.place(Number(c),Number(o),l,d);a.listOfShips.push(p),1==n.every((e=>a.listOfShips.includes(e)))?h(e,i,t,a):r(e,i,t,a)})),l.addEventListener("dragover",(function(e){1!=a.Gameboard.grid[e.target.getAttribute("data-indexX")][e.target.getAttribute("data-indexY")].hasShip&&1!=a.Gameboard.grid[e.target.getAttribute("data-indexX")][e.target.getAttribute("data-indexY")].nearShip||(e.target.style.border="1px dashed red"),e.preventDefault()}))),c.appendChild(l)}))}));break;case"pvc":for(;c.firstChild;)c.removeChild(c.firstChild);for(;o.firstChild;)o.removeChild(o.firstChild);e.Gameboard.grid.forEach((i=>{i.forEach((t=>{const a=document.createElement("div");a.classList.add("cell");let n=e.Gameboard.grid.indexOf(i),r=i.indexOf(t);a.setAttribute("data-indexY",r),a.setAttribute("data-indexX",n),1==t.hasShip&&a.classList.add("hasShip"),1==t.wasShot&&0==t.hasShip&&a.classList.add("waterHit"),1==t.wasShot&&1==t.hasShip&&a.classList.add("shipHit"),null!=t.shipName&&1==t.shipName.isSunk()&&a.classList.add("shipSunk"),c.appendChild(a)}))})),i.Gameboard.grid.forEach((a=>{a.forEach((n=>{const s=document.createElement("div");s.classList.add("cell");let l=i.Gameboard.grid.indexOf(a),h=a.indexOf(n);s.setAttribute("data-indexX",l),s.setAttribute("data-indexY",h),1==n.wasShot&&1==n.hasShip&&s.classList.add("shipHit"),1==n.wasShot&&0==n.hasShip&&s.classList.add("waterHit"),null!=n.shipName&&1==n.shipName.isSunk()&&s.classList.add("shipSunk"),0==n.wasShot&&s.addEventListener("click",(()=>{e.attackPlayer(s.getAttribute("data-indexX"),s.getAttribute("data-indexY"),i),i.computerAttack(e),r(e,i,"pvc"),d(e,i,t)})),o.appendChild(s)}))}));break;case"pvp":for(;c.firstChild;)c.removeChild(c.firstChild);for(;o.firstChild;)o.removeChild(o.firstChild);u.querySelector(".shipList").style.visibility="hidden",p.innerHTML=a===e?"Player 1's Turn":"Player 2's Turn",a.Gameboard.grid.forEach((e=>{e.forEach((i=>{const t=document.createElement("div");t.classList.add("cell");let n=a.Gameboard.grid.indexOf(e),r=e.indexOf(i);t.setAttribute("data-indexY",r),t.setAttribute("data-indexX",n),1==i.hasShip&&t.classList.add("hasShip"),1==i.wasShot&&0==i.hasShip&&t.classList.add("waterHit"),1==i.wasShot&&1==i.hasShip&&t.classList.add("shipHit"),null!=i.shipName&&1==i.shipName.isSunk()&&t.classList.add("shipSunk"),c.appendChild(t)}))}));let S=a===e?i:e;S.Gameboard.grid.forEach((n=>{n.forEach((r=>{const s=document.createElement("div");s.classList.add("cell");let l=S.Gameboard.grid.indexOf(n),c=n.indexOf(r);s.setAttribute("data-indexX",l),s.setAttribute("data-indexY",c),1==r.wasShot&&1==r.hasShip&&s.classList.add("shipHit"),1==r.wasShot&&0==r.hasShip&&s.classList.add("waterHit"),null!=r.shipName&&1==r.shipName.isSunk()&&s.classList.add("shipSunk"),0==r.wasShot&&s.addEventListener("click",(()=>{a.attackPlayer(s.getAttribute("data-indexX"),s.getAttribute("data-indexY"),S),h(e,i,t,a),d(e,i,t)})),o.appendChild(s)}))}))}},s=(e,i,r,s)=>{const d=document.querySelector(".winner"),c=document.querySelector(".waiting");for(d.innerHTML="Please drag and drop all your ships...";c.firstChild;)c.removeChild(c.firstChild);const o=document.createElement("ul");o.classList.add("shipList");const p=document.createElement("li");p.innerHTML="Patrol",s.listOfShips.includes("patrol")&&(p.style.visibility="hidden"),p.setAttribute("id","patrol"),p.setAttribute("data-orientation","h"),p.setAttribute("draggable","true"),p.addEventListener("click",a),p.addEventListener("dragstart",t);const u=document.createElement("li");u.innerHTML="Submarine",s.listOfShips.includes("submarine")&&(u.style.visibility="hidden"),u.setAttribute("id","submarine"),u.setAttribute("data-orientation","h"),u.setAttribute("draggable","true"),u.addEventListener("click",a),u.addEventListener("dragstart",t);const S=document.createElement("li");S.innerHTML="Destroyer",s.listOfShips.includes("destroyer")&&(S.style.visibility="hidden"),S.setAttribute("id","destroyer"),S.setAttribute("data-orientation","h"),S.setAttribute("draggable","true"),S.addEventListener("click",a),S.addEventListener("dragstart",t);const m=document.createElement("li");m.innerHTML="Battleship",s.listOfShips.includes("battleship")&&(m.style.visibility="hidden"),m.setAttribute("id","battleship"),m.setAttribute("data-orientation","h"),m.setAttribute("draggable","true"),m.addEventListener("click",a),m.addEventListener("dragstart",t);const b=document.createElement("li");b.innerHTML="Carrier",s.listOfShips.includes("carrier")&&(b.style.visibility="hidden"),b.setAttribute("id","carrier"),b.setAttribute("data-orientation","h"),b.setAttribute("draggable","true"),b.addEventListener("click",a),b.addEventListener("dragstart",t);const f=document.createElement("button");f.classList.add("rngPlace-btn"),f.innerHTML="Random Place",f.addEventListener("click",(()=>{l(s),1==n.every((i=>e.listOfShips.includes(i)))&&0==n.every((e=>i.listOfShips.includes(e)))&&h(e,i,r,s),1==n.every((i=>e.listOfShips.includes(i)))&&1==n.every((e=>i.listOfShips.includes(e)))&&h(e,i,"pvp",s)})),o.appendChild(p),o.appendChild(u),o.appendChild(S),o.appendChild(m),o.appendChild(b),c.appendChild(f),c.appendChild(o)},d=(e,i,t)=>{const a=document.querySelector(".player1 .attackBoard"),n=document.querySelector(".winner"),r=document.querySelector(".player1 .shipsBoard"),s=document.querySelector(".waiting");if("pvc"==t)if(1==e.Gameboard.checkAllSunk()&&1==i.Gameboard.checkAllSunk())r.style.visibility="hidden",a.style.visibility="hidden",s.style.visibility="hidden",n.innerHTML="It's a Tie!";else if(1==e.Gameboard.checkAllSunk()&&0==i.Gameboard.checkAllSunk())r.style.visibility="hidden",a.style.visibility="hidden",s.style.visibility="hidden",n.innerHTML="Computer Won!";else{if(0!=e.Gameboard.checkAllSunk()||1!=i.Gameboard.checkAllSunk())return;r.style.visibility="hidden",a.style.visibility="hidden",s.style.visibility="hidden",n.innerHTML="Player 1 Won!"}else"pvp"==t&&1==e.Gameboard.checkAllSunk()&&(r.style.visibility="hidden",a.style.visibility="hidden",s.style.visibility="hidden",n.innerHTML="You Won!")},l=e=>{for(let i=n.length-1;i>=0;i--)if(!e.listOfShips.includes(n[i])){let t,a=Math.floor(10*Math.random()),r=Math.floor(10*Math.random());t=a%2==0?"v":"h";let s=e.Gameboard.place(a,r,t,n[i]);for(;void 0===s;)a=Math.floor(10*Math.random()),r=Math.floor(10*Math.random()),t=a%2==0?"v":"h",s=e.Gameboard.place(a,r,t,n[i]);e.listOfShips.push(s)}},h=(e,i,t,a)=>{const s=document.querySelector(".player1 .shipsBoard"),d=document.querySelector(".player1 .attackBoard"),l=document.querySelector(".winner"),h=document.querySelector(".waiting"),c=document.querySelector(".rngPlace-btn");s.style.visibility="hidden",d.style.visibility="hidden",h.querySelector(".shipList").style.visibility="hidden",c.style.visibility="hidden",1==n.every((i=>e.listOfShips.includes(i)))&&1==n.every((e=>i.listOfShips.includes(e)))&&(t="pvp"),l.innerHTML=a===i?"Player 1 click when ready...":"Player 2 click when ready...",a=a===e?i:e;const o=document.createElement("button");o.classList.add("readyBtn"),o.innerHTML="Ready!",o.addEventListener("click",(()=>{s.style.visibility="visible",d.style.visibility="visible",h.querySelector(".shipList").style.visibility="visible",h.removeChild(o),r(e,i,t,a)})),h.appendChild(o)},c=r,o=e=>{const t=document.querySelector(".newGameBtn");t.innerHTML="Restart",t.removeEventListener("click",p),t.addEventListener("click",(function(){location.reload()})),document.querySelector(".playVs").style.visibility="hidden",(e=>{const t=i(),a=i();c(t,a,"pvc"===e?"pvcPlace":"pvpPlace")})(e)},p=()=>{const e=document.querySelector(".playVs");"hidden"==e.style.visibility?e.style.visibility="visible":e.style.visibility="hidden"};document.querySelector(".playVs").style.visibility="hidden",document.querySelector(".newGameBtn").addEventListener("click",p),document.querySelector("button.PvC").addEventListener("click",(()=>o("pvc"))),document.querySelector("button.PvP").addEventListener("click",(()=>o("pvp")))})();